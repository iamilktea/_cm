# 習題 13 : 常係數齊次常微分方程通用求解器

本專案實作了一個通用的 Python 函數 `solve_ode_general(coefficients)`，能夠求解任意階數的**常係數齊次常微分方程 (Homogeneous Linear ODE with Constant Coefficients)**。

## ⚠️ 來源宣告
> 本作業程式碼與數學原理解析由本人參考課堂講義與微積分/工數教材，並在 AI (ChatGPT/Gemini) 協助下解決 `numpy` 浮點數誤差問題與字串格式化邏輯。

## 1. 數學原理

對於一個 $n$ 階常係數齊次 ODE：
$$a_n y^{(n)} + a_{n-1} y^{(n-1)} + \dots + a_1 y' + a_0 y = 0$$

其通解取決於**特徵方程式 (Characteristic Equation)** 的根：
$$a_n \lambda^n + a_{n-1} \lambda^{n-1} + \dots + a_1 \lambda + a_0 = 0$$

根據特徵根 $\lambda$ 的性質，通解由以下線性組合構成：

### (1) 相異實根 (Distinct Real Roots)
若 $\lambda = r$，則基本解為：
$$e^{rx}$$

### (2) 重複實根 (Repeated Real Roots)
若 $\lambda = r$ 出現 $k$ 次 (重數為 $k$)，則對應的 $k$ 個線性獨立解為：
$$e^{rx}, \quad x e^{rx}, \quad x^2 e^{rx}, \quad \dots, \quad x^{k-1} e^{rx}$$

### (3) 複數根 (Complex Roots)
若 $\lambda = \alpha \pm \beta i$ (共軛複數)，則對應的實函數解為：
$$e^{\alpha x} \cos(\beta x), \quad e^{\alpha x} \sin(\beta x)$$

### (4) 重複複數根 (Repeated Complex Roots)
若 $\lambda = \alpha \pm \beta i$ 出現 $k$ 次，則需乘上 $x$ 的冪次修正：
$$x^m e^{\alpha x} \cos(\beta x), \quad x^m e^{\alpha x} \sin(\beta x) \quad (m = 0, 1, \dots, k-1)$$

---

## 2. 程式實作邏輯 (`ode1.py`)

為了寫出一個通用的求解器，我們面臨了幾個挑戰，以下是我的解決方案：

### A. 特徵根求解
使用 `numpy.roots(coefficients)` 可以快速求出高次多項式的所有根。
* **輸入**：係數陣列 `[1, -3, 2]` 代表 $\lambda^2 - 3\lambda + 2 = 0$。

### B. 關鍵挑戰：浮點數誤差處理 (為什麼要這樣寫？)
這是本程式最核心的部分。
* **問題**：數值方法求解根時會有微小誤差。例如 $(x-2)^2=0$ 的根，電腦算出來可能是 `1.99999999` 和 `2.00000001`。如果直接判定，電腦會認為這是「兩個相異實根」，導致公式用錯（沒有乘上 $x$）。
* **解決方案**：
    1.  **四捨五入 (`round`)**：將實部與虛部統一四捨五入到小數點後 5 位，強制讓 `1.99999` 變成 `2.0`。
    2.  **虛部清洗**：有些實根會帶有極小的虛部 (如 `1e-15j`)，若 `abs(imag) ≈ 0`，則強制設為 0。
    3.  **統計重數 (`Counter`)**：清洗數據後，使用 `collections.Counter` 統計每個根出現的次數，精確判斷重根。

### C. 字串格式化
為了讓輸出像人類手寫的數學式：
* 若係數為 1 或 0，程式會自動隱藏 (例如顯示 $x$ 而不是 $1x$，顯示 $1$ 而不是 $e^{0x}$)。
* 實數若為整數 (如 `2.0`)，會格式化為 `2` 以保持美觀。

---

## 3. 執行結果

程式針對五種不同情況進行了測試，結果如下：

### 測試 1: 實數單根 ($y'' - 3y' + 2y = 0$)
* 特徵根：1, 2
* **結果**：`y(x) = C_1e^(1x) + C_2e^(2x)`

### 測試 2: 實數重根 ($y'' - 4y' + 4y = 0$)
* 特徵根：2 (重數 2)
* **結果**：`y(x) = C_1e^(2x) + C_2xe^(2x)` (正確判斷出重根，補上了 $x$)

### 測試 3: 複數共軛根 ($y'' + 4y = 0$)
* 特徵根：$\pm 2i$
* **結果**：`y(x) = C_1cos(2x) + C_2sin(2x)` (實部為 0，省略 $e^{0x}$)

### 測試 4: 複數重根 $((D^2+1)^2 y = 0$)
* 特徵根：$\pm i, \pm i$ (重數 2)
* **結果**：`y(x) = C_1cos(1x) + C_2sin(1x) + C_3xcos(1x) + C_4xsin(1x)`

### 測試 5: 高階重根 ($(r-2)^3=0$)
* 特徵根：2 (重數 3)
* **結果**：`y(x) = C_1e^(2x) + C_2xe^(2x) + C_3x^2e^(2x)`

## 4. 如何執行

請確保安裝 `numpy`，然後執行：

```bash
python ode1.py
